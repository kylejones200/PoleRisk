{% extends "base.html" %}

{% block title %}Soil Moisture Analyzer - Home{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="bg-primary text-white rounded p-5">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <h1 class="display-5 mb-3"><i class="fas fa-seedling me-3"></i> Soil Moisture Analyzer</h1>
                        <p class="lead mb-3">Advanced analysis and machine learning for AMSR2 LPRM soil moisture data</p>
                        <p class="mb-4">Upload your soil moisture data, train machine learning models, detect anomalies, and generate forecasts with our comprehensive analysis platform.</p>
                        
                        <div class="d-flex flex-wrap gap-2">
                            <a class="btn btn-light btn-lg" href="{{ url_for('dashboard.dashboard') }}" role="button">
                                <i class="fas fa-chart-line me-2"></i> Open Dashboard
                            </a>
                            <a class="btn btn-outline-light btn-lg" href="{{ url_for('dashboard.upload_page') }}" role="button">
                                <i class="fas fa-upload me-2"></i> Upload Data
                            </a>
                            <button class="btn btn-success btn-lg" onclick="loadSampleData()" id="sample-data-btn">
                                <i class="fas fa-database me-2"></i> Use Sample Data
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-4 text-center">
                        <i class="fas fa-seedling opacity-50" style="font-size: 8rem;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="fas fa-chart-line fa-3x text-primary"></i>
                </div>
                <h5 class="card-title">Interactive Dashboard</h5>
                <p class="card-text">
                    Visualize your soil moisture data with interactive time series plots, scatter plots, and statistical summaries.
                </p>
                <a href="{{ url_for('dashboard.dashboard') }}" class="btn btn-primary">
                    <i class="fas fa-tachometer-alt"></i> View Dashboard
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="fas fa-brain fa-3x text-success"></i>
                </div>
                <h5 class="card-title">Machine Learning</h5>
                <p class="card-text">
                    Train predictive models, detect anomalies, and generate forecasts using advanced ML algorithms including neural networks.
                </p>
                <a href="{{ url_for('dashboard.models_page') }}" class="btn btn-success">
                    <i class="fas fa-robot"></i> ML Models
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="fas fa-code fa-3x text-info"></i>
                </div>
                <h5 class="card-title">REST API</h5>
                <p class="card-text">
                    Integrate with your existing workflows using our comprehensive REST API for programmatic access to all features.
                </p>
                <a href="{{ url_for('dashboard.api_docs') }}" class="btn btn-info">
                    <i class="fas fa-book"></i> API Docs
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-star"></i> Key Features</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success"></i> 
                                AMSR2 LPRM data processing
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success"></i> 
                                In-situ data validation
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success"></i> 
                                Statistical analysis (RMSE, bias, correlation)
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success"></i> 
                                Interactive visualizations
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success"></i> 
                                Machine learning predictions
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success"></i> 
                                Anomaly detection
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success"></i> 
                                Time series forecasting
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success"></i> 
                                Rust-optimized performance
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-info-circle"></i> System Status</h5>
            </div>
            <div class="card-body">
                <div id="system-status-loading" class="loading">
                    <div class="spinner-border spinner-border-sm" role="status"></div>
                    <span class="ms-2">Loading status...</span>
                </div>
                <div id="system-status" style="display: none;">
                    <div class="mb-3">
                        <small class="text-muted">Data Files</small>
                        <div class="h5" id="data-files-count">-</div>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted">ML Models</small>
                        <div class="h5" id="model-files-count">-</div>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted">Capabilities</small>
                        <div id="capabilities-list"></div>
                    </div>
                    <div class="text-center">
                        <a href="/health" target="_blank" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-heartbeat"></i> Health Check
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0"><i class="fas fa-rocket"></i> Getting Started</h5>
                </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 text-center mb-3">
                        <div class="mb-3">
                            <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center" 
                                 style="width: 48px; height: 48px;">
                                <span class="h5 mb-0">1</span>
                            </div>
                        </div>
                        <h6>Upload or Load Data</h6>
                        <p class="small text-muted">
                            Upload your files or use sample data from AMSR2 LPRM satellite measurements
                        </p>
                    </div>
                    <div class="col-md-3 text-center mb-3">
                        <div class="mb-3">
                            <div class="bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center" 
                                 style="width: 48px; height: 48px;">
                                <span class="h5 mb-0">2</span>
                            </div>
                        </div>
                        <h6>Explore Dashboard</h6>
                        <p class="small text-muted">
                            View interactive visualizations and analyze your data patterns
                        </p>
                    </div>
                    <div class="col-md-3 text-center mb-3">
                        <div class="mb-3">
                            <div class="bg-info text-white rounded-circle d-inline-flex align-items-center justify-content-center" 
                                 style="width: 48px; height: 48px;">
                                <span class="h5 mb-0">3</span>
                            </div>
                        </div>
                        <h6>Train Models</h6>
                        <p class="small text-muted">
                            Use machine learning to predict soil moisture and detect anomalies
                        </p>
                    </div>
                    <div class="col-md-3 text-center mb-3">
                        <div class="mb-3">
                            <div class="bg-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center" 
                                 style="width: 48px; height: 48px;">
                                <span class="h5 mb-0">4</span>
                            </div>
                        </div>
                        <h6>Analyze Results</h6>
                        <p class="small text-muted">
                            Export results, generate reports, and integrate with your workflows
                        </p>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadSystemStatus();
});

async function loadSystemStatus() {
    const statusContainer = document.getElementById('system-status');
    const loadingContainer = document.getElementById('system-status-loading');
    
    try {
        showLoading('system-status-loading');
        
        const response = await fetch('/api/status');
        const status = await response.json();
        
        document.getElementById('data-files-count').textContent = status.system?.data_files || '0';
        document.getElementById('model-files-count').textContent = status.system?.model_files || '0';
        
        const capabilities = status.capabilities || {};
        const capabilitiesList = document.getElementById('capabilities-list');
        
        let capabilitiesHtml = '';
        for (const [key, available] of Object.entries(capabilities)) {
            const icon = available ? 'fas fa-check-circle text-success' : 'fas fa-times-circle text-danger';
            const label = key.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
            capabilitiesHtml += `
                <div class="small mb-1">
                    <i class="${icon}"></i> ${label}
                </div>
            `;
        }
        capabilitiesList.innerHTML = capabilitiesHtml;
        
        hideLoading('system-status-loading');
        statusContainer.style.display = 'block';
        
    } catch (error) {
        hideLoading('system-status-loading');
        document.getElementById('system-status').innerHTML = `
            <div class="text-danger">
                <i class="fas fa-exclamation-triangle"></i> 
                Failed to load system status
            </div>
        `;
        statusContainer.style.display = 'block';
    }
}

async function loadSampleData() {
    const btn = document.getElementById('sample-data-btn');
    const originalText = btn.innerHTML;
    
    try {
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Loading Sample Data...';
        
        const response = await fetch('/api/load-sample-data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        const result = await response.json();
        
        if (response.ok) {
            // Show success message
            showNotification('success', 'Sample Data Loaded!', 
                `Successfully loaded ${result.filename}. You can now explore the dashboard.`);
            
            // Redirect to dashboard after a short delay
            setTimeout(() => {
                window.location.href = '/dashboard';
            }, 2000);
        } else {
            throw new Error(result.error || 'Failed to load sample data');
        }
        
    } catch (error) {
        showNotification('error', 'Error Loading Sample Data', error.message);
        btn.disabled = false;
        btn.innerHTML = originalText;
    }
}

function showNotification(type, title, message) {
    const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
    const iconClass = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
    
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
    alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    alertDiv.innerHTML = `
        <i class="${iconClass} me-2"></i>
        <strong>${title}</strong><br>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // Auto-dismiss after 5 seconds
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

function showLoading(elementId) {
    // Helper function
}

function hideLoading(elementId) {
    // Helper function
}
</script>
{% endblock %}
